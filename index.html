<!DOCTYPE html>
<html>
<head>
  <title>Pili Camera</title>
  <meta name="keywords" content="Pili Camera" />
  <meta name="description" content="Pili Camera" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <link rel="stylesheet" type="text/css" href="http://cdn.staticfile.org/twitter-bootstrap/3.3.0/css/bootstrap.min.css">
  <script type="text/javascript" src="http://cdn.staticfile.org/jquery/2.1.1-rc2/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.staticfile.org/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
  <style type="text/css">
    .form-group:last-child{margin-bottom:0;}
  </style>
</head>
<body>

  <div class="container">

    <h2 class="text-center">Camera settings</h2>

    <div class="row">
      <div class="col-md-8 col-md-offset-2">

        <div id="notice"></div>

        <form class="form-horizontal well" id="settings">
          <div class="form-group">
            <label for="push-url" class="col-sm-2 control-label">Push URL</label>
            <div class="col-sm-10">
              <input type="url" class="form-control" name="rtmp" id="push-url">
            </div>
          </div>

          <div class="form-group">
            <label for="push-url" class="col-sm-2 control-label">Stream Key</label>
            <div class="col-sm-10">
              <input type="url" class="form-control" name="stream_key" id="stream-key">
            </div>
          </div>

          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <button type="button" class="btn btn-info" id="save">Save</button>
              <button type="button" class="btn btn-info" id="start">Start push</button>
              <button type="button" class="btn btn-info" id="stop">Stop push</button>
            </div>
          </div>
        </form>

      </div>
    </div>

    <div class="text-center" id="qrcode"></div>

  </div>


  <script charset="utf-8">
    $(function(){

      $.ajax({
        type: "GET",
        url: "getconf",  //Here to fill you get the push_url and stream_key of the URL
        // dataType: "string",
        success: function(data){
          var split = data.split('|')
          $('#push-url').val(split[0]);
          $('#stream-key').val(split[1]);

          var slices = $('#push-url').val().split('/')
          $('#qrcode').empty().qrcode('{"sid":"'+slices[slices.length - 1]+'"}');
        },
        error: function(){
          $('#notice').addClass('alert alert-danger').text('Get push_url and stream_key failed!');
        }
      });

      $('body').on('click', 'button', function(){
        $('#notice').removeAttr('class').empty();
      });

      $('body').on('click', '#save', function(){
        $.ajax({
          type: "PUT",
          data: $('#settings').serialize(),
          url: "setconf",  //Here to fill you save the configuration of the URL
          success: function(data){
            $('#notice').addClass('alert alert-success').text('Configuration success!');
            var slices = $('#push-url').val().split('/')
            $('#qrcode').empty().qrcode('{"sid":"'+slices[slices.length - 1]+'"}');
          },
          error: function(){
            $('#notice').addClass('alert alert-danger').text('Configuration failed!');
          }
        });
      });

      $('body').on('click', '#start', function(){
        $.ajax({
          type: "PUT",
          url: "start",  //Here to fill you start to push the stream of events URL
          success: function(){
            $('#notice').addClass('alert alert-success').text('Is pushing the stream!');
          },
          error: function(){
            $('#notice').addClass('alert alert-danger').text('Streaming failure!');
          }
        });
      });

      $('body').on('click', '#stop', function(){
        $.ajax({
          type: "PUT",
          url: "stop",  //Push here to fill you stop the flow of events URL
          success: function(){
            $('#notice').addClass('alert alert-success').text('Push the flow has stopped!');
          },
          error: function(){
            $('#notice').addClass('alert alert-danger').text('Stop pushing flow failure!');
          }
        });
      });
    });
  </script>

</body>
</html>
